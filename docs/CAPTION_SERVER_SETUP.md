# YouTube Caption Server Setup

The Baratie app uses a Python-based caption server to extract transcripts from YouTube videos. This server must be running alongside the main web app for YouTube recipe extraction to work properly.

## Prerequisites

- Python 3.7 or higher
- pip (Python package manager)

## Installation

1. **Install the required Python package:**

```bash
pip install youtube-transcript-api
```

## Running the Caption Server

1. **Start the server:**

```bash
python caption-server.py
```

The server will start on port 8000 and display:
```
Starting caption server on port 8000...
Test page: http://localhost:8000/test-captions.html
Press Ctrl+C to stop
```

2. **Keep the server running** while using the Baratie app

3. **To stop the server**, press `Ctrl+C`

## How It Works

The caption server:
- Listens on `http://localhost:8000/api/youtube-captions`
- Uses the `youtube-transcript-api` Python library to fetch captions
- Tries multiple English variants (en, en-US, en-GB, en-CA, en-AU)
- Falls back to any available language if English isn't available
- Returns timestamped captions in JSON format

## Integration with Main App

The main app (`app/app.js`) automatically calls the caption server when:
- Extracting recipes from YouTube videos
- Generating video timestamps for recipe instructions
- Checking caption availability for the timestamp toggle

The app expects the server at `http://localhost:8000/api/youtube-captions`

## Testing

You can test the caption server independently:

1. Start the server: `python caption-server.py`
2. Open test page: `http://localhost:8000/test-captions.html`
3. Enter a YouTube video ID or URL
4. Click "Test Caption API"

Test with these video IDs:
- `s2_DepctcIc` - English video
- `xE2amr9yl00` - Hindi video (tests fallback)
- `dQw4w9WgXcQ` - Rick Astley (popular video with captions)

## Troubleshooting

### "No captions available" error
- Some videos don't have captions/transcripts
- Private or age-restricted videos may not work
- Try with a different video that definitely has captions

### Connection refused
- Make sure the caption server is running (`python caption-server.py`)
- Check that port 8000 is not being used by another application
- Verify the server shows "Starting caption server on port 8000..."

### Module not found error
- Install the package: `pip install youtube-transcript-api`
- Check Python version: `python --version` (should be 3.7+)

## API Endpoint

**POST** `http://localhost:8000/api/youtube-captions`

**Request Body:**
```json
{
  "videoId": "dQw4w9WgXcQ"
}
```

**Response (Success):**
```json
{
  "success": true,
  "hasCaptions": true,
  "language": "en",
  "isAutoGenerated": true,
  "captions": [
    {
      "start": 0.0,
      "duration": 2.5,
      "text": "Caption text here"
    }
  ],
  "trackInfo": {
    "language": "English",
    "isAutoGenerated": true
  }
}
```

**Response (No Captions):**
```json
{
  "error": "No captions available",
  "hasCaptions": false
}
```

## Production Deployment

For production, you would need to:
1. Deploy the Python server as a separate service (e.g., on Heroku, Railway, or similar)
2. Update the URL in `app/app.js` from `http://localhost:8000` to your deployed server URL
3. Ensure proper CORS headers are configured
4. Consider rate limiting and caching for heavy usage

Alternatively, you could convert this to a Vercel serverless function, but the current standalone Python server approach is simpler and more reliable for development.
